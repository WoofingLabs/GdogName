<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add GDOG to MetaMask</title>
    <link rel="icon" type="image/png" href="https://woofinglabs.github.io/GdogToTheMoon/images/gdog_logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center justify-center p-4">
    <header class="w-full max-w-md text-center mb-6">
        <img src="https://woofinglabs.github.io/GdogToTheMoon/images/gdog_logo.png" alt="GDOG Logo" class="w-24 h-24 mx-auto rounded-full border-2 border-green-400">
        <h1 class="text-3xl font-bold text-blue-400 mt-2">Add GDOG to MetaMask</h1>
    </header>

    <main class="w-full max-w-md bg-gray-800 p-6 rounded-lg shadow-lg">
        <p id="walletInfo" class="text-sm text-gray-400 mb-4">Detecting wallet...</p>
        <div class="mb-4">
            <p class="text-sm text-gray-400">Contract: <span class="font-mono">0xA037355662d34D9B57dE209E22544a4862F5A30c</span></p>
            <button class="mt-2 px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-500" onclick="copyContract()">Copy Address</button>
        </div>
        <div class="flex items-center justify-between mb-4">
            <div>
                <p class="text-sm text-gray-400">Symbol: GDOG</p>
                <p class="text-sm text-gray-400">Decimals: 18</p>
            </div>
            <button id="addTokenButton" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-500 disabled:bg-gray-500" disabled>Add to MetaMask</button>
        </div>
        <div id="networkStatus" class="text-sm text-gray-400 mb-2">Current Chain ID: <span id="currentChainId">N/A</span></div>
        <button id="switchNetworkButton" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 mb-4" onclick="switchNetwork()">Switch to Gate Layer (10088)</button>
        <div id="manualGuide" class="text-sm text-gray-400 hidden">
            <p><strong>Manual Network Setup (if auto-switch fails):</strong></p>
            <ul class="list-disc list-inside mt-2">
                <li>Network Name: Gate Layer</li>
                <li>RPC URL: https://gatelayer-mainnet.gatenode.cc</li>
                <li>Chain ID: 10088</li>
                <li>Currency Symbol: GT</li>
                <li>Block Explorer: https://www.gatescan.org/gatelayer/</li>
            </ul>
            <p class="mt-2">In MetaMask: Settings > Networks > Add Network > Enter above details.</p>
            <p>Then import token: Assets > Import Token > Custom Token > Use contract address above.</p>
        </div>
    </main>

    <footer class="mt-auto text-center text-gray-500 text-xs py-4">
        <p>Â© 2025 GDOG. DYOR and invest responsibly.</p>
    </footer>

    <script>
        const token = {
            address: "0xA037355662d34D9B57dE209E22544a4862F5A30c",
            symbol: "GDOG",
            decimals: 18,
            logo: "https://woofinglabs.github.io/GdogToTheMoon/images/gdog_logo.png"
        };

        const gateLayer = {
            chainId: '0x2768', // 10088 in hex
            chainName: 'Gate Layer',
            rpcUrls: ['https://gatelayer-mainnet.gatenode.cc'],
            nativeCurrency: { name: 'GT', symbol: 'GT', decimals: 18 },
            blockExplorerUrls: ['https://www.gatescan.org/gatelayer/']
        };

        function detectWallet() {
            const provider = window.ethereum;
            console.log('Ethereum provider:', provider);
            return provider && provider.isMetaMask ? { name: 'MetaMask', provider } : { name: null, provider: null };
        }

        function updateWalletInfo() {
            const { name, provider } = detectWallet();
            const walletInfo = document.getElementById('walletInfo');
            const addButton = document.getElementById('addTokenButton');
            if (name === 'MetaMask') {
                walletInfo.textContent = 'Detected: MetaMask';
                addButton.disabled = false;
                checkNetwork(provider);
            } else {
                walletInfo.textContent = 'Please install MetaMask.';
                addButton.disabled = true;
            }
        }

        async function checkNetwork(provider) {
            try {
                const rawChainId = await provider.request({ method: 'eth_chainId' });
                const chainId = rawChainId.startsWith('0x') ? rawChainId : `0x${Number(rawChainId).toString(16)}`;
                document.getElementById('currentChainId').textContent = chainId;
                console.log('Raw Chain ID:', rawChainId, 'Normalized:', chainId);

                const switchButton = document.getElementById('switchNetworkButton');
                const manualGuide = document.getElementById('manualGuide');
                if (chainId === gateLayer.chainId) {
                    switchButton.classList.add('hidden');
                    manualGuide.classList.add('hidden');
                } else {
                    switchButton.classList.remove('hidden');
                    manualGuide.classList.remove('hidden');
                    alert(`Wrong Chain ID: ${chainId}. Please switch to ${gateLayer.chainId} (10088).`);
                }
            } catch (error) {
                console.error('Network check error:', error);
                alert('Failed to check network. Ensure MetaMask is connected.');
            }
        }

        async function switchNetwork() {
            const { provider } = detectWallet();
            if (!provider) return alert('MetaMask not detected!');
            try {
                await provider.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: gateLayer.chainId }]
                });
                alert('Switched to Gate Layer (10088). Refresh page to continue.');
                location.reload();
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await provider.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: gateLayer.chainId,
                                chainName: gateLayer.chainName,
                                rpcUrls: gateLayer.rpcUrls,
                                nativeCurrency: gateLayer.nativeCurrency,
                                blockExplorerUrls: gateLayer.blockExplorerUrls
                            }]
                        });
                        alert('Added Gate Layer network. Switch to it in MetaMask and refresh.');
                    } catch (addError) {
                        console.error('Add network error:', addError);
                        alert('Failed to add network. Use manual guide below.');
                    }
                } else {
                    console.error('Switch network error:', switchError);
                    alert('Switch failed. Use manual guide below.');
                }
            }
        }

        async function addToken() {
            const { provider } = detectWallet();
            if (!provider) return alert('MetaMask not detected!');
            try {
                const rawChainId = await provider.request({ method: 'eth_chainId' });
                const chainId = rawChainId.startsWith('0x') ? rawChainId : `0x${Number(rawChainId).toString(16)}`;
                if (chainId !== gateLayer.chainId) {
                    alert('Please switch to Chain ID 10088 first.');
                    return;
                }
                const wasAdded = await provider.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: { address: token.address, symbol: token.symbol, decimals: token.decimals, image: token.logo }
                    }
                });
                if (wasAdded) {
                    alert('GDOG added to MetaMask with Logo!');
                } else {
                    alert('Cancelled. Use manual guide below.');
                }
            } catch (error) {
                console.error('Add token error:', error);
                alert('Add failed. Use manual guide below.');
            }
        }

        function copyContract() {
            navigator.clipboard.writeText(token.address).then(() => alert('Address copied!'));
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateWalletInfo();
            document.getElementById('addTokenButton').addEventListener('click', addToken);
            document.getElementById('switchNetworkButton').addEventListener('click', switchNetwork);
        });
    </script>
</body>
</html>
